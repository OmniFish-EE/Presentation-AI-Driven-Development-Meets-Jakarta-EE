<?xml version="1.0" encoding="UTF-8"?>
<svg width="1000" height="650" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .actor-box { fill: #e6f3ff; stroke: #0066cc; stroke-width: 2; }
      .text { font-family: Arial, sans-serif; font-size: 12px; }
      .title { font-weight: bold; font-size: 16px; }
      .method { font-size: 11px; }
      .lifeline { stroke: #666; stroke-width: 2; stroke-dasharray: 5,5; }
      .message { stroke: #333; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .return { stroke: #666; stroke-width: 1; stroke-dasharray: 3,3; marker-end: url(#arrowhead); }
      .activation { fill: #ffffcc; stroke: #333; stroke-width: 1; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333" />
    </marker>
  </defs>

  <!-- Title -->
  <text x="500" y="30" class="text title" text-anchor="middle">UPDATE Operation Sequence Diagram</text>

  <!-- Actors -->
  <rect x="50" y="60" width="80" height="40" class="actor-box"/>
  <text x="90" y="85" class="text" text-anchor="middle">Client</text>

  <rect x="180" y="60" width="100" height="40" class="actor-box"/>
  <text x="230" y="85" class="text" text-anchor="middle">Controller</text>

  <rect x="330" y="60" width="100" height="40" class="actor-box"/>
  <text x="380" y="85" class="text" text-anchor="middle">Service</text>

  <rect x="480" y="60" width="120" height="40" class="actor-box"/>
  <text x="540" y="85" class="text" text-anchor="middle">ValidationUtils</text>

  <rect x="650" y="60" width="100" height="40" class="actor-box"/>
  <text x="700" y="85" class="text" text-anchor="middle">Repository</text>

  <rect x="800" y="60" width="100" height="40" class="actor-box"/>
  <text x="850" y="85" class="text" text-anchor="middle">Database</text>

  <!-- Lifelines -->
  <line x1="90" y1="100" x2="90" y2="580" class="lifeline"/>
  <line x1="230" y1="100" x2="230" y2="580" class="lifeline"/>
  <line x1="380" y1="100" x2="380" y2="580" class="lifeline"/>
  <line x1="540" y1="100" x2="540" y2="580" class="lifeline"/>
  <line x1="700" y1="100" x2="700" y2="580" class="lifeline"/>
  <line x1="850" y1="100" x2="850" y2="580" class="lifeline"/>

  <!-- Messages -->
  <!-- 1. Client to Controller -->
  <line x1="90" y1="130" x2="230" y2="130" class="message"/>
  <text x="160" y="125" class="text method">PUT /api/people/1</text>
  <text x="160" y="140" class="text method">{"firstName":"Jane", "lastName":"Smith"}</text>

  <!-- Activation boxes -->
  <rect x="225" y="130" width="10" height="420" class="activation"/>

  <!-- 2. Controller to Service -->
  <line x1="235" y1="160" x2="380" y2="160" class="message"/>
  <text x="307" y="155" class="text method">update(1, request)</text>

  <rect x="375" y="160" width="10" height="360" class="activation"/>

  <!-- 3. Service to ValidationUtils (firstName) -->
  <line x1="385" y1="190" x2="540" y2="190" class="message"/>
  <text x="462" y="185" class="text method">validateAndTrimString("Jane", "First name", 50)</text>

  <rect x="535" y="190" width="10" height="40" class="activation"/>

  <!-- 4. ValidationUtils return -->
  <line x1="535" y1="220" x2="385" y2="220" class="return"/>
  <text x="460" y="215" class="text method">"Jane"</text>

  <!-- 5. Service to ValidationUtils (lastName) -->
  <line x1="385" y1="240" x2="540" y2="240" class="message"/>
  <text x="462" y="235" class="text method">validateAndTrimString("Smith", "Last name", 50)</text>

  <rect x="535" y="240" width="10" height="40" class="activation"/>

  <!-- 6. ValidationUtils return -->
  <line x1="535" y1="270" x2="385" y2="270" class="return"/>
  <text x="460" y="265" class="text method">"Smith"</text>

  <!-- 7. Service to Repository (find existing) -->
  <line x1="385" y1="300" x2="700" y2="300" class="message"/>
  <text x="542" y="295" class="text method">findById(1)</text>

  <rect x="695" y="300" width="10" height="60" class="activation"/>

  <!-- 8. Repository to Database -->
  <line x1="705" y1="320" x2="850" y2="320" class="message"/>
  <text x="777" y="315" class="text method">SELECT * FROM people WHERE id=1</text>

  <rect x="845" y="320" width="10" height="20" class="activation"/>

  <!-- 9. Database return -->
  <line x1="845" y1="340" x2="705" y2="340" class="return"/>
  <text x="775" y="335" class="text method">Person entity</text>

  <!-- 10. Repository return -->
  <line x1="695" y1="360" x2="385" y2="360" class="return"/>
  <text x="540" y="355" class="text method">Optional&lt;Person&gt;</text>

  <!-- 11. Service updates entity -->
  <rect x="390" y="380" width="120" height="30" fill="#ffeeee" stroke="#cc0000"/>
  <text x="450" y="400" class="text method" text-anchor="middle">person.setFirstName("Jane")</text>

  <rect x="390" y="415" width="120" height="30" fill="#ffeeee" stroke="#cc0000"/>
  <text x="450" y="435" class="text method" text-anchor="middle">person.setLastName("Smith")</text>

  <!-- 12. Service to Repository (save) -->
  <line x1="385" y1="460" x2="700" y2="460" class="message"/>
  <text x="542" y="455" class="text method">save(person)</text>

  <rect x="695" y="460" width="10" height="60" class="activation"/>

  <!-- 13. Repository to Database -->
  <line x1="705" y1="480" x2="850" y2="480" class="message"/>
  <text x="777" y="475" class="text method">UPDATE people SET ...</text>

  <rect x="845" y="480" width="10" height="20" class="activation"/>

  <!-- 14. Database return -->
  <line x1="845" y1="500" x2="705" y2="500" class="return"/>
  <text x="775" y="495" class="text method">Updated entity</text>

  <!-- 15. Repository return -->
  <line x1="695" y1="520" x2="385" y2="520" class="return"/>
  <text x="540" y="515" class="text method">Person entity</text>

  <!-- 16. Service return -->
  <line x1="375" y1="540" x2="235" y2="540" class="return"/>
  <text x="305" y="535" class="text method">Person entity</text>

  <!-- 17. Controller return -->
  <line x1="225" y1="560" x2="90" y2="560" class="return"/>
  <text x="157" y="555" class="text method">HTTP 200 + Updated Person JSON</text>

  <!-- Transaction boundaries -->
  <rect x="370" y="150" width="490" height="380" fill="none" stroke="#00aa00" stroke-width="2" stroke-dasharray="10,5"/>
  <text x="375" y="145" class="text" fill="#00aa00">@Transactional</text>

  <!-- Notes -->
  <rect x="50" y="590" width="850" height="40" fill="#f0f0f0" stroke="#999"/>
  <text x="60" y="610" class="text">Notes: Update operations validate input, find existing entity, modify it, and save changes within a transaction</text>

</svg>
