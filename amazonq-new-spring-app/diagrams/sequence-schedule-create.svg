<?xml version="1.0" encoding="UTF-8"?>
<svg width="1200" height="800" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .actor-box { fill: #e6f3ff; stroke: #0066cc; stroke-width: 2; }
      .text { font-family: Arial, sans-serif; font-size: 12px; }
      .title { font-weight: bold; font-size: 16px; }
      .method { font-size: 10px; }
      .lifeline { stroke: #666; stroke-width: 2; stroke-dasharray: 5,5; }
      .message { stroke: #333; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .return { stroke: #666; stroke-width: 1; stroke-dasharray: 3,3; marker-end: url(#arrowhead); }
      .activation { fill: #ffffcc; stroke: #333; stroke-width: 1; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333" />
    </marker>
  </defs>

  <!-- Title -->
  <text x="600" y="30" class="text title" text-anchor="middle">Schedule CREATE Operation - Complex Multi-Entity Validation</text>

  <!-- Actors -->
  <rect x="50" y="60" width="80" height="40" class="actor-box"/>
  <text x="90" y="85" class="text" text-anchor="middle">Client</text>

  <rect x="150" y="60" width="90" height="40" class="actor-box"/>
  <text x="195" y="85" class="text" text-anchor="middle">Controller</text>

  <rect x="260" y="60" width="90" height="40" class="actor-box"/>
  <text x="305" y="85" class="text" text-anchor="middle">Service</text>

  <rect x="370" y="60" width="100" height="40" class="actor-box"/>
  <text x="420" y="85" class="text" text-anchor="middle">ValidationUtils</text>

  <rect x="490" y="60" width="90" height="40" class="actor-box"/>
  <text x="535" y="85" class="text" text-anchor="middle">PersonRepo</text>

  <rect x="600" y="60" width="90" height="40" class="actor-box"/>
  <text x="645" y="85" class="text" text-anchor="middle">SubjectRepo</text>

  <rect x="710" y="60" width="90" height="40" class="actor-box"/>
  <text x="755" y="85" class="text" text-anchor="middle">GradeRepo</text>

  <rect x="820" y="60" width="90" height="40" class="actor-box"/>
  <text x="865" y="85" class="text" text-anchor="middle">ScheduleRepo</text>

  <rect x="930" y="60" width="90" height="40" class="actor-box"/>
  <text x="975" y="85" class="text" text-anchor="middle">Database</text>

  <!-- Lifelines -->
  <line x1="90" y1="100" x2="90" y2="720" class="lifeline"/>
  <line x1="195" y1="100" x2="195" y2="720" class="lifeline"/>
  <line x1="305" y1="100" x2="305" y2="720" class="lifeline"/>
  <line x1="420" y1="100" x2="420" y2="720" class="lifeline"/>
  <line x1="535" y1="100" x2="535" y2="720" class="lifeline"/>
  <line x1="645" y1="100" x2="645" y2="720" class="lifeline"/>
  <line x1="755" y1="100" x2="755" y2="720" class="lifeline"/>
  <line x1="865" y1="100" x2="865" y2="720" class="lifeline"/>
  <line x1="975" y1="100" x2="975" y2="720" class="lifeline"/>

  <!-- Messages -->
  <!-- 1. Client to Controller -->
  <line x1="90" y1="130" x2="195" y2="130" class="message"/>
  <text x="142" y="125" class="text method">POST /api/schedules</text>
  <text x="142" y="140" class="text method">{"dayOfWeek":1, "timeSlot":1, "teacherId":1, "subjectId":1, "gradeId":1}</text>

  <!-- Activation boxes -->
  <rect x="190" y="130" width="10" height="560" class="activation"/>

  <!-- 2. Controller to Service -->
  <line x1="200" y1="160" x2="305" y2="160" class="message"/>
  <text x="252" y="155" class="text method">create(request)</text>

  <rect x="300" y="160" width="10" height="500" class="activation"/>

  <!-- 3. Service to ValidationUtils (dayOfWeek) -->
  <line x1="310" y1="180" x2="420" y2="180" class="message"/>
  <text x="365" y="175" class="text method">validateAndConvertToInteger(1, "Day of week", 1, 5)</text>

  <rect x="415" y="180" width="10" height="30" class="activation"/>
  <line x1="415" y1="200" x2="310" y2="200" class="return"/>
  <text x="362" y="195" class="text method">1</text>

  <!-- 4. Service to ValidationUtils (timeSlot) -->
  <line x1="310" y1="220" x2="420" y2="220" class="message"/>
  <text x="365" y="215" class="text method">validateAndConvertToInteger(1, "Time slot", 1, 4)</text>

  <rect x="415" y="220" width="10" height="30" class="activation"/>
  <line x1="415" y1="240" x2="310" y2="240" class="return"/>
  <text x="362" y="235" class="text method">1</text>

  <!-- 5. Service to ValidationUtils (teacherId) -->
  <line x1="310" y1="260" x2="420" y2="260" class="message"/>
  <text x="365" y="255" class="text method">validateAndConvertToLong(1, "Teacher ID")</text>

  <rect x="415" y="260" width="10" height="30" class="activation"/>
  <line x1="415" y1="280" x2="310" y2="280" class="return"/>
  <text x="362" y="275" class="text method">1L</text>

  <!-- 6. Service to PersonRepo (find teacher) -->
  <line x1="310" y1="300" x2="535" y2="300" class="message"/>
  <text x="422" y="295" class="text method">findById(1L)</text>

  <rect x="530" y="300" width="10" height="60" class="activation"/>
  <line x1="540" y1="320" x2="975" y2="320" class="message"/>
  <text x="757" y="315" class="text method">SELECT * FROM people WHERE id=1</text>

  <rect x="970" y="320" width="10" height="20" class="activation"/>
  <line x1="970" y1="340" x2="540" y2="340" class="return"/>
  <text x="755" y="335" class="text method">Teacher entity</text>

  <line x1="530" y1="360" x2="310" y2="360" class="return"/>
  <text x="420" y="355" class="text method">Optional&lt;Person&gt;</text>

  <!-- 7. Service to ValidationUtils (subjectId) -->
  <line x1="310" y1="380" x2="420" y2="380" class="message"/>
  <text x="365" y="375" class="text method">validateAndConvertToLong(1, "Subject ID")</text>

  <rect x="415" y="380" width="10" height="30" class="activation"/>
  <line x1="415" y1="400" x2="310" y2="400" class="return"/>
  <text x="362" y="395" class="text method">1L</text>

  <!-- 8. Service to SubjectRepo -->
  <line x1="310" y1="420" x2="645" y2="420" class="message"/>
  <text x="477" y="415" class="text method">findById(1L)</text>

  <rect x="640" y="420" width="10" height="60" class="activation"/>
  <line x1="650" y1="440" x2="975" y2="440" class="message"/>
  <text x="812" y="435" class="text method">SELECT * FROM subjects WHERE id=1</text>

  <rect x="970" y="440" width="10" height="20" class="activation"/>
  <line x1="970" y1="460" x2="650" y2="460" class="return"/>
  <text x="810" y="455" class="text method">Subject entity</text>

  <line x1="640" y1="480" x2="310" y2="480" class="return"/>
  <text x="475" y="475" class="text method">Optional&lt;Subject&gt;</text>

  <!-- 9. Service to ValidationUtils (gradeId) -->
  <line x1="310" y1="500" x2="420" y2="500" class="message"/>
  <text x="365" y="495" class="text method">validateAndConvertToLong(1, "Grade ID")</text>

  <rect x="415" y="500" width="10" height="30" class="activation"/>
  <line x1="415" y1="520" x2="310" y2="520" class="return"/>
  <text x="362" y="515" class="text method">1L</text>

  <!-- 10. Service to GradeRepo -->
  <line x1="310" y1="540" x2="755" y2="540" class="message"/>
  <text x="532" y="535" class="text method">findById(1L)</text>

  <rect x="750" y="540" width="10" height="60" class="activation"/>
  <line x1="760" y1="560" x2="975" y2="560" class="message"/>
  <text x="867" y="555" class="text method">SELECT * FROM grades WHERE id=1</text>

  <rect x="970" y="560" width="10" height="20" class="activation"/>
  <line x1="970" y1="580" x2="760" y2="580" class="return"/>
  <text x="865" y="575" class="text method">Grade entity</text>

  <line x1="750" y1="600" x2="310" y2="600" class="return"/>
  <text x="530" y="595" class="text method">Optional&lt;Grade&gt;</text>

  <!-- 11. Service creates Schedule -->
  <rect x="315" y="620" width="100" height="30" fill="#ffeeee" stroke="#cc0000"/>
  <text x="365" y="640" class="text method" text-anchor="middle">new Schedule()</text>

  <!-- 12. Service to ScheduleRepo -->
  <line x1="310" y1="660" x2="865" y2="660" class="message"/>
  <text x="587" y="655" class="text method">save(schedule)</text>

  <rect x="860" y="660" width="10" height="60" class="activation"/>
  <line x1="870" y1="680" x2="975" y2="680" class="message"/>
  <text x="922" y="675" class="text method">INSERT INTO schedules</text>

  <rect x="970" y="680" width="10" height="20" class="activation"/>
  <line x1="970" y1="700" x2="870" y2="700" class="return"/>
  <text x="920" y="695" class="text method">Schedule with ID</text>

  <line x1="860" y1="720" x2="310" y2="720" class="return"/>
  <text x="585" y="715" class="text method">Schedule entity</text>

  <!-- Returns -->
  <line x1="300" y1="740" x2="200" y2="740" class="return"/>
  <text x="250" y="735" class="text method">Schedule entity</text>

  <line x1="190" y1="760" x2="90" y2="760" class="return"/>
  <text x="140" y="755" class="text method">HTTP 200 + Schedule JSON</text>

  <!-- Transaction boundaries -->
  <rect x="295" y="150" width="690" height="580" fill="none" stroke="#00aa00" stroke-width="2" stroke-dasharray="10,5"/>
  <text x="300" y="145" class="text" fill="#00aa00">@Transactional</text>

  <!-- Notes -->
  <rect x="50" y="780" width="1100" height="60" fill="#f0f0f0" stroke="#999"/>
  <text x="60" y="800" class="text">Notes:</text>
  <text x="60" y="815" class="text">• Schedule creation requires validation of multiple entities (Teacher, Subject, Grade)</text>
  <text x="60" y="830" class="text">• All validations happen within a single transaction to ensure data consistency</text>

</svg>
