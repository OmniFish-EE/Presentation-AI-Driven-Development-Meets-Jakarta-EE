<?xml version="1.0" encoding="UTF-8"?>
<svg width="1000" height="600" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .actor-box { fill: #e6f3ff; stroke: #0066cc; stroke-width: 2; }
      .text { font-family: Arial, sans-serif; font-size: 12px; }
      .title { font-weight: bold; font-size: 16px; }
      .method { font-size: 11px; }
      .lifeline { stroke: #666; stroke-width: 2; stroke-dasharray: 5,5; }
      .message { stroke: #333; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .return { stroke: #666; stroke-width: 1; stroke-dasharray: 3,3; marker-end: url(#arrowhead); }
      .activation { fill: #ffffcc; stroke: #333; stroke-width: 1; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333" />
    </marker>
  </defs>

  <!-- Title -->
  <text x="500" y="30" class="text title" text-anchor="middle">CREATE Operation Sequence Diagram</text>

  <!-- Actors -->
  <rect x="50" y="60" width="80" height="40" class="actor-box"/>
  <text x="90" y="85" class="text" text-anchor="middle">Client</text>

  <rect x="180" y="60" width="100" height="40" class="actor-box"/>
  <text x="230" y="85" class="text" text-anchor="middle">Controller</text>

  <rect x="330" y="60" width="100" height="40" class="actor-box"/>
  <text x="380" y="85" class="text" text-anchor="middle">Service</text>

  <rect x="480" y="60" width="120" height="40" class="actor-box"/>
  <text x="540" y="85" class="text" text-anchor="middle">ValidationUtils</text>

  <rect x="650" y="60" width="100" height="40" class="actor-box"/>
  <text x="700" y="85" class="text" text-anchor="middle">Repository</text>

  <rect x="800" y="60" width="100" height="40" class="actor-box"/>
  <text x="850" y="85" class="text" text-anchor="middle">Database</text>

  <!-- Lifelines -->
  <line x1="90" y1="100" x2="90" y2="550" class="lifeline"/>
  <line x1="230" y1="100" x2="230" y2="550" class="lifeline"/>
  <line x1="380" y1="100" x2="380" y2="550" class="lifeline"/>
  <line x1="540" y1="100" x2="540" y2="550" class="lifeline"/>
  <line x1="700" y1="100" x2="700" y2="550" class="lifeline"/>
  <line x1="850" y1="100" x2="850" y2="550" class="lifeline"/>

  <!-- Messages -->
  <!-- 1. Client to Controller -->
  <line x1="90" y1="130" x2="230" y2="130" class="message"/>
  <text x="160" y="125" class="text method">POST /api/people</text>
  <text x="160" y="140" class="text method">{"firstName":"John", "lastName":"Doe"}</text>

  <!-- Activation boxes -->
  <rect x="225" y="130" width="10" height="380" class="activation"/>

  <!-- 2. Controller to Service -->
  <line x1="235" y1="160" x2="380" y2="160" class="message"/>
  <text x="307" y="155" class="text method">create(request)</text>

  <rect x="375" y="160" width="10" height="320" class="activation"/>

  <!-- 3. Service to ValidationUtils -->
  <line x1="385" y1="190" x2="540" y2="190" class="message"/>
  <text x="462" y="185" class="text method">validateAndTrimString("John", "First name", 50)</text>

  <rect x="535" y="190" width="10" height="40" class="activation"/>

  <!-- 4. ValidationUtils return -->
  <line x1="535" y1="220" x2="385" y2="220" class="return"/>
  <text x="460" y="215" class="text method">"John"</text>

  <!-- 5. Service to ValidationUtils (lastName) -->
  <line x1="385" y1="240" x2="540" y2="240" class="message"/>
  <text x="462" y="235" class="text method">validateAndTrimString("Doe", "Last name", 50)</text>

  <rect x="535" y="240" width="10" height="40" class="activation"/>

  <!-- 6. ValidationUtils return -->
  <line x1="535" y1="270" x2="385" y2="270" class="return"/>
  <text x="460" y="265" class="text method">"Doe"</text>

  <!-- 7. Service creates Person entity -->
  <rect x="390" y="290" width="120" height="30" fill="#ffeeee" stroke="#cc0000"/>
  <text x="450" y="310" class="text method" text-anchor="middle">new Person()</text>

  <!-- 8. Service to Repository -->
  <line x1="385" y1="340" x2="700" y2="340" class="message"/>
  <text x="542" y="335" class="text method">save(person)</text>

  <rect x="695" y="340" width="10" height="100" class="activation"/>

  <!-- 9. Repository to Database -->
  <line x1="705" y1="370" x2="850" y2="370" class="message"/>
  <text x="777" y="365" class="text method">INSERT INTO people</text>

  <rect x="845" y="370" width="10" height="40" class="activation"/>

  <!-- 10. Database return -->
  <line x1="845" y1="400" x2="705" y2="400" class="return"/>
  <text x="775" y="395" class="text method">Person with ID</text>

  <!-- 11. Repository return -->
  <line x1="695" y1="430" x2="385" y2="430" class="return"/>
  <text x="540" y="425" class="text method">Person entity</text>

  <!-- 12. Service return -->
  <line x1="375" y1="460" x2="235" y2="460" class="return"/>
  <text x="305" y="455" class="text method">Person entity</text>

  <!-- 13. Controller return -->
  <line x1="225" y1="490" x2="90" y2="490" class="return"/>
  <text x="157" y="485" class="text method">HTTP 200 + Person JSON</text>

  <!-- Transaction boundaries -->
  <rect x="370" y="150" width="340" height="340" fill="none" stroke="#00aa00" stroke-width="2" stroke-dasharray="10,5"/>
  <text x="375" y="145" class="text" fill="#00aa00">@Transactional</text>

  <!-- Notes -->
  <rect x="50" y="520" width="850" height="60" fill="#f0f0f0" stroke="#999"/>
  <text x="60" y="540" class="text">Notes:</text>
  <text x="60" y="555" class="text">• All string inputs are validated and trimmed using ValidationUtils</text>
  <text x="60" y="570" class="text">• Service layer handles transaction boundaries and business logic</text>

</svg>
